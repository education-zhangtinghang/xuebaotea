<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<title>课程订单</title>
		<script type="text/javascript" src="../js/zoom/flexible.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style>
			body,
			html {
				height: 100%;
				width: 100%;
			}
			/*班课样式*/
			
			.content {
				height: 100%;
			}
			/*一对一样式*/
			
			.one_box {
				padding: 0;
				margin-bottom: 0.222222rem;
			}
			
			.box_head {
				background-color: #FFFFFF;
				margin-top: 0.222222rem;
				display: flex;
				padding: 0 5%;
				align-items: center;
				height: 0.833333rem;
				color: #555555;
				position: relative;
				border-bottom: 1px solid rgb(240,240,240);
			}
			/*框架样式调整*/
			
			.mui-control-content {
				background-color: white;
				min-height: 300px;
			}
			
			.mui-control-content .mui-loading {
				margin-top: 50px;
			}
			
			#sliderProgressBar {
				width: 30%;
				margin-left: 10%;
				height: 2px;
				background-color: #0dad95;
				margin-top: -1px;
				margin-bottom: 0.097222rem;
				position: relative;
			}
			
			.mui-active {
				color: #0dad95 !important;
			}
			
			.mui-slider {
				height: 100%;
			}
			
			.mui-scroll {
				padding-bottom: 3.294444rem;
			}
			
			.mui-control-content {
				background-color: rgb(239, 239, 244);
			}
			
			.mui-slider-indicator.mui-segmented-control {
				background-color: #FFFFFF;
			}
			
			.mui-slider-group {
				height: 100% !important;
			}
			
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item {
				border: none !important;
			}
			/*顶部样式*/
			
			.list_item {
				width: 100%;
				padding: 0.377777rem;
				background-color: #FEFEFE;
				padding-top: 0.791666rem;
			}
			
			.list_item_ul {
				display: flex;
				align-items: center;
			}
			
			.list_item_ul li {
				width: 33.33%;
				text-align: center;
				border-right: 2px solid rgba(220, 220, 220, 0.8);
			}
			
			.list_item_ul li:last-child {
				border: none;
			}
			
			.list_item_num {
				font-size: 0.5rem;
				color: #333333;
			}
			
			.list_item_text {
				color: #888888;
				font-size: 0.388888rem;
			}
			/*补充样式*/
			
			.slider_header {
				display: flex;
				background-color: #FFFFFF;
			}
			
			.header_avatar {
				width: 1.25rem;
				height: 1.25rem;
				border-radius: 90px;
				overflow: hidden;
				margin: 0.388888rem 5%;
			}
			
			.header_avatar img {
				width: 100%;
				height: 100%;
			}
			
			.header_body {
				margin: 0.388888rem 0;
				padding-top: 0.138888rem;
			}
			
			.body_title {
				width: 7rem;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			
			.title_text {
				width: 80%;
				font-size: 0.444444rem;
				color: #333333;
			}
			
			.title_text img {
				width: 0.388888rem;
				height: 0.388888rem;
				margin-left: 2%;
			}
			
			.title_icon {
				width: 0.444444rem;
				height: 0.555555rem;
			}
			
			.title_icon img {
				width: 100%;
				height: 100%;
			}
			
			.body_content {
				margin-top: 0.319444rem;
				font-size: 0.388888rem;
				color: #555555;
			}
			/*列表样式*/
			
			.circle_icon {
				width: 0.111111rem;
				height: 0.111111rem;
				border-radius: 90px;
				background-color: #0dad95;
				margin-right: 0.111111rem;
			}
			
			.nav_title {
				color: #0DAD95;
			}
			
			.nav_more {
				position: absolute;
				right: 5%;
				top: 50%;
				margin-top: -0.276666rem;
			}
			
			.class_list {
				padding: 0 5%;
				display: flex;
				align-items: center;
				justify-content: space-between;
				border-bottom: 2px solid rgb(240, 240, 240);
				background-color: #FFFFFF;
			}
			
			.class_list:active {
				background-color: rgb(240, 240, 240);
			}
			
			.class_list_left {
				color: #333333;
				font-size: 0.444444rem;
				margin-top: 0.388888rem;
			}
			
			.left_location {
				font-size: 0.388888rem;
				margin-top: 0.597222rem;
				margin-bottom: 0.388888rem;
			}
			
			.class_list_right {
				display: flex;
				align-items: center;
				font-size: 0.388888rem;
				color: #888888;
			}
			
			.right_come_icon {
				width: 0.25rem;
				height: 0.416666rem;
				margin-left: 0.222222rem;
			}
			.right_come_icon img{
				width: 100%;
				height: 100%;
			}
			
			.no_feedback {
				color: #0DAD95;
				border: 2px solid #0DAD95;
				border-radius: 18px;
				padding: 0 0.288888rem;
				margin-left: 0.375rem;
				font-size: 0.333333rem;
			}
			
			.feedback {
				color: #888888;
				border: 2px solid #888888;
				border-radius: 18px;
				padding: 0 0.288888rem;
				margin-left: 0.375rem;
				font-size: 0.333333rem;
			}
			
			.list_left_box {
				display: flex;
				align-items: center;
			}
			
			.tuition_right_num {
				font-size: 0.388888rem;
				margin-top: 0.597222rem;
				margin-bottom: 0.388888rem;
				color: #555555;
			}
			
			.tuition_right_num>span {
				color: #fc9874;
			}
			
			.tuition_list_right {
				margin-top: 0.3888888rem;
			}
			
			.tuition_right_time {
				text-align: right;
				color: #888888;
				font-size: 0.388888rem;
			}
			.rank{
				color: #FFFFFF;
				border-radius: 8px;
				padding: 0.038888rem 0.3058888rem;
				margin-left: 0.375rem;
				font-size: 0.333333rem;
			}
			.rank_1{
				background-color: #ffd908;
			}
			.rank_2{
				background-color: #0dad95;
			}
			.rank_3{
				background-color: #fc8455;
			}
			.rank_4{
				background-color: #1b82d1;
			}
			.wait_time{
				color: #0DAD95 !important;
			}
		</style>
	</head>

	<body>
		<div class="content" id="msg-content">
			<div id="slider" class="mui-slider">
				<div class="slider_header">
					<div class="header_avatar"><img src="../images/status/not_login_head.png" v-if="student" onload="load(this,vm.student.studentImage)" /></div>
					<div class="header_body">
						<div class="body_title"><span class="title_text"><span v-text="student.name"></span><img :src="student.gender=='男'?'../images/student/male.png':'../images/student/female.png'" /></span><span class="title_icon" :data-phone="student.mobilephone" id="callPhone"><img src="../images/student/call_student.png" /></span></div>
						<div class="body_content"><span v-text="student.className"></span></div>
					</div>
				</div>
				<div id="sliderSegmentedControl" class=" mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<a class="mui-control-item" href="#item1mobile">
						课程
					</a>
					<a class="mui-control-item" href="#item2mobile">
						学费
					</a>
				</div>
				<div id="sliderProgressBar"></div>
				<div id="mui-slider-group" class="mui-slider-group">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">

								<div class="list_item">
									<ul class="list_item_ul">
										<li>
											<div class="list_item_num" v-text="coursesinfo.waitcourse"></div>
											<div class="list_item_text">待上课/分</div>
										</li>
										<li>
											<div class="list_item_num" v-text="coursesinfo.teachedcourse"></div>
											<div class="list_item_text">已上课/分</div>
										</li>
										<li>
											<div class="list_item_num" v-text="coursesinfo.duration"></div>
											<div class="list_item_text">总时长/分</div>
										</li>
										<li id="wait_time" :data-time = "coursesinfo.planCourse">
											<div class="list_item_num wait_time" v-text="coursesinfo.planCourse"></div>
											<div class="list_item_text wait_time">待排课/分</div>
										</li>
									</ul>
								</div>
								<div class="one_box">
									<div class="box_head">
										<div class="circle_icon"></div>
										<div class="nav_title">待上课</div>
									</div>
									<div class="wait_class">
										<div v-for="(item,index) in course">
											<div v-if="item.onetoonetype==0">
												<div class="class_list"  @tap="wait_class(item,vm.student,item.onetoonetype)">
													<div class="class_list_left">
														<div>{{item.courseStartTime | courseTime}}-{{item.courseEndTime |courseTime}}</div>
														<div class="left_location">{{item.organizationId | origaniztion}}</div>
													</div>
													<div class="class_list_right">
														<div class="right_time">{{item.courseStartTime | dateTime}}</div>
														<div class="right_come_icon"><img src="../images/main/js_grzl_youjiantou.png" /></div>
													</div>
												</div>
											</div>
											<div v-else-if="item.onetoonetype==1">
												<div class="class_list" v-for="courseItem in item.courseSection" v-if="courseItem.courseSectionStatus==2" @tap="wait_class(courseItem,vm.student,item.onetoonetype,item.organizationId,item.courseTypeName)">
													<div class="class_list_left">
														<div>{{courseItem.courseStartDate | courseTime}}-{{courseItem.courseEndDate | courseTime}}</div>
														<div class="left_location">{{item.organizationId | origaniztion}}</div>
													</div>
													<div class="class_list_right">
														<div class="right_time">{{courseItem.courseStartDate | dateTime}}</div>
														<div class="right_come_icon"><img src="../images/main/js_grzl_youjiantou.png" /></div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>															
										<!--<div class="class_list">
											<div class="class_list_left">
												<div>14:30-16:30</div>
												<div class="left_location">都江堰-东软店</div>
											</div>
											<div class="class_list_right">
												<div class="right_time">10月27号</div>
												<div class="right_come_icon"><img src="../images/main/js_grzl_youjiantou.png" /></div>
											</div>
										</div>-->

									

									<div class="box_head">
										<div class="circle_icon"></div>
										<div class="nav_title">已完成</div>
										<div class="nav_more" id="succ_more">更多</div>
									</div>
									<div class="succ_class">
										<div v-for="(item, index) in course">
											<div v-if="item.onetoonetype==0">
												<div class="class_list" :class="item.courseSection.length>0?'feedback_yes':'feedback_no'" :data-courseId="item.courseSection.length>0?'':item.id" :data-data="item.classId">
													<div class="class_list_left">
														<div class="list_left_box">{{item.courseStartTime | courseTime}}-{{item.courseEndTime | | courseTime}}<span class="no_feedback" v-if="item.courseSection.length<=0">未反馈</span><span class="feedback" v-else="item.courseSection.length>0">已反馈</span></div>
														<div class="left_location">{{item.organizationId | origaniztion}}</div>
													</div>
													<div class="class_list_right">
														<div class="right_time">{{item.courseStartTime | dateTime}}</div>
														<div class="right_come_icon"><img src="../images/main/js_grzl_youjiantou.png" /></div>
													</div>
												</div>
											</div>
											<div v-if="item.onetoonetype==1">
												<div class="class_list" v-for="courseItem in item.courseSection" :class="courseItem.courseFeedback?'feedback_yes':'feedback_no'" :data-courseId="courseItem.courseFeedback?'':courseItem.id" :data-data="item.classId">
													<div class="class_list_left">
														<div class="list_left_box">{{courseItem.courseStartDate | courseTime}}-{{courseItem.courseEndDate | courseTime}}<span class="no_feedback" v-if="!courseItem.courseFeedback">未反馈</span><span class="feedback" v-else>已反馈</span></div>
														<div class="left_location">{{item.organizationId | origaniztion}}</div>
													</div>
													<div class="class_list_right">
														<div class="right_time">{{courseItem.courseStartDate | dateTime}}</div>
														<div class="right_come_icon"><img src="../images/main/js_grzl_youjiantou.png" /></div>
													</div>
												</div>
											</div>
										</div>
										<!--<div class="class_list feedback_yes">
											<div class="class_list_left">
												<div class="list_left_box">14:30-16:30<span class="feedback">已反馈</span></div>
												<div class="left_location">都江堰-东软店</div>
											</div>
											<div class="class_list_right">
												<div class="right_time">10月27号</div>
												<div class="right_come_icon"><img src="../images/main/js_grzl_youjiantou.png" /></div>
											</div>
										</div>-->
										
									</div>
									

									<!--<div class="class_list">
										<div class="class_list_left"><div class="list_left_box">语文<span class="rank">基础级</span></div><div class="left_location">报课时长：30小时</div></div>
										<div class="tuition_list_right"><div class="right_time tuition_right_time">10月27号</div><div class="tuition_right_num">订单金额：<span>50000.0学币</span></div></div>
									</div>-->
								</div>

							</div>
						</div>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div id="scroll2" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<div class="list_item">
									<ul class="list_item_ul">
										<li>
											<div class="list_item_num" v-text="(tuitioninfo.consume/100).toFixed(2)||0"></div>
											<div class="list_item_text">已消费/学币</div>
										</li>
										<li>
											<div class="list_item_num" v-text="(tuitioninfo.waitconsume/100).toFixed(2)||0"></div>
											<div class="list_item_text">待消费/学币</div>
										</li>
										<li>
											<div class="list_item_num" v-text="(tuitioninfo.alltuition/100).toFixed(2)||0"></div>
											<div class="list_item_text">总缴费/学币</div>
										</li>
									</ul>
								</div>
								<div class="box_head">
									<div class="circle_icon"></div>
									<div class="nav_title">报课记录</div>
								</div>
								
								<div class="class_list" v-for="item in course">
									<div class="class_list_left">
										<div class="list_left_box"><span v-text="item.subjectName"></span>
											<span v-if="item.courseTypeName =='基础级'" class="rank rank_1">基础级</span>
											<span v-else-if="item.courseTypeName =='培优级'" class="rank rank_2">培优级</span>
											<span v-else-if="item.courseTypeName =='竞赛级'" class="rank rank_3">竞赛级</span>
											<span v-else="item.courseTypeName =='一对一'" class="rank rank_4">一对一</span>
										</div>
										<div class="left_location">报课时长：<span v-text="item.courseDuration"></span>分钟</div>
									</div>
									<div class="tuition_list_right">
										<div class="right_time tuition_right_time">{{item.courseEndTime | dateTime}}</div>
										<div class="tuition_right_num">订单金额：<span v-if="item.orderCourse" v-text="item.orderCourse.shopPrize/100"></span><span v-else v-text="0"></span> 学币</div>
									</div>
								</div>
								
								<!--<div class="class_list">
									<div class="class_list_left">
										<div class="list_left_box">语文<span class="rank rank_1">基础级</span></div>
										<div class="left_location">报课时长：30小时</div>
									</div>
									<div class="tuition_list_right">
										<div class="right_time tuition_right_time">10月27号</div>
										<div class="tuition_right_num">订单金额：<span>5000.0</span>学币</div>
									</div>
								</div>-->
								


								<!--<div class="mui-loading">
									<div class="mui-spinner">
									</div>
								</div>-->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--取出加密值-->
        <input type="text" style="visibility:hidden" id="getPassword" value="" />
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/config.js"></script>
		<script type="text/javascript" src="../js/hmac-sha1.js" ></script>
		<script type="text/javascript" src="../js/login_config.js" ></script>
		<script type="text/javascript" src="../js/vue.min.js" ></script>
		<script type="text/javascript" src="../js/md5.min.js" ></script>
		<script type="text/javascript" src="../js/imgload.js" ></script>
		<script type="text/javascript" src="../js/ajax.js" ></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				//监听返回
				listenReturn();
				var self = plus.webview.currentWebview();
				var studentId = self.studentId;
				var courseData = '';
				//获取列表
				getStudentDetail();
				window.addEventListener('showView',function(){
					getStudentDetail();
				})
				 function getStudentDetail(){
				 	var ajaxData = {
	                    url:'restful1/teacher/getstudentinfo',
	                    data: {
	                    	studentId:studentId
	                    },
	                    type:'post'
	                }
	                ajax(ajaxData, function(data){
	                    if(data.code == 200){
	                    	//得到学生信息
	                    	vm.student = data.data.student;
	                    	vm.coursesinfo = data.data.coursesinfo;
	                    	vm.tuitioninfo = data.data.tuitioninfo;
	                    	vm.courseArr = data.data.course;
	                    	vm.imgUrl = ajaxUrl;
	                    	courseData = data;
	                    }              
	                },true,true);
				 }
                //评论刷新
                
                //拨打电话
                document.getElementById("callPhone").addEventListener('tap',function(){
                	var phone = this.getAttribute('data-phone');
                	//拨打电话
		    		plus.device.dial(phone,true);
                });
                //待排课跳转
				document.getElementById("wait_time").addEventListener('tap',function(){
					var waitTime = this.getAttribute('data-time');
					openView.nativeView('../pages_main/course_scheduling.html','course_scheduling', '排课',{waitTime:waitTime,studentId:studentId});	
				});
				//未反馈
				mui('.succ_class').on('tap','.feedback_no',function(){
					//无接口 应该是使用id提交课堂反馈
					var courseId = this.getAttribute('data-courseId');
					openView.nativeView('../pages_main/fill_feedback.html','fill_feedback', '课堂反馈',{courseId:courseId});
				});
				//已反馈
				mui('.succ_class').on('tap','.feedback_yes',function(){
					var classId = this.getAttribute('data-data');
					var course = courseData.data.course;
					console.log(JSON.stringify(course))
					var coursePeopleStr = JSON.stringify(courseData.data.student);
					var dataStr =JSON.stringify(feedbackData(course,classId));
					openView.nativeView('../pages_student/course_detail.html','course_detail', '课程详情',{coursePeopleStr:coursePeopleStr,dataStr:dataStr});
				});
				//已完成更多
				document.getElementById("succ_more").addEventListener('tap',function(){
					plus.nativeUI.toast('此功能尚未开通！');
//					openView.nativeView('course_record.html','course_record.html', '课程记录','','none');	
				})
			})
			
			//时间
			Vue.filter('courseTime',function(value){
				if(value){
					var value = value.split(" ");
					var time = value[1].split(":");
					return time[0]+':'+time[1];
				}	
			})
			//日期
			Vue.filter('dateTime',function(value){
				if(value){
					var time = value.replace(/-/g,"/");
					time = new Date(time);
					var getMonth = time.getMonth()+1;
					var getHour = time.getDate();
					return getMonth +'月'+getHour+'日';
				}
			})
			//地点
			Vue.filter('origaniztion',function(origin){
				return originid(origin);
			})
			//数据
			function feedbackData(valObj,index){
				for(var i=0;i<valObj.length;i++){
					if(valObj[i].classId == index){
						return valObj[i];
					}else{
						return {};
					}
				}
			}
			//待上课
			function wait_class(course,data,type,organizationId,courseTypeName) {
				var courseData = JSON.stringify(course);
				var data = JSON.stringify(data);
				openView.nativeView('course_message.html','course_message', '课程详情',{courseData:courseData,data:data,type:type,organizationId:organizationId,courseTypeName:courseTypeName});	
			}
			var vm = new Vue({
                el: '#msg-content',
                data: {
                    student:{},
                    coursesinfo:{},
                    tuitioninfo:{},
                    courseArr:[],
                    imgUrl:''
                },
                computed: {
					course: function () {
						return this.courseArr.reverse();
					}
				}
           })
			//DIV局部滚动
			mui('.mui-scroll-wrapper').scroll({
				indicators: false //是否显示滚动条
			});
//			var html2 = '<div class="list_item"><ul class="list_item_ul"><li><div class="list_item_num">100</div><div class="list_item_text">已消费/学币</div></li><li><div class="list_item_num">700</div><div class="list_item_text">待消费/学币</div></li><li><div class="list_item_num">686</div><div class="list_item_text">总缴费/学币</div></li></ul></div><div class="box_head"><div class="circle_icon"></div><div class="nav_title">报课记录</div></div><div class="class_list"><div class="class_list_left"><div class="list_left_box">语文<span class="rank">基础级</span></div><div class="left_location">报课时长：30小时</div></div><div class="tuition_list_right"><div class="right_time tuition_right_time">10月27号</div><div class="tuition_right_num">订单金额：<span>50000.0学币</span></div></div></div>';
//			var item2 = document.getElementById('item2mobile');
			document.getElementById('slider').addEventListener('slide', function(e) {
				if(e.detail.slideNumber === 0) {
					sliderProgressBar.style.marginLeft = '10%';
				} else if(e.detail.slideNumber === 1) {
					sliderProgressBar.style.marginLeft = '60%';
					//					if (item2.querySelector('.mui-loading')) {
					//						setTimeout(function() {
					//							item2.querySelector('.mui-scroll').innerHTML = html2;
					//						}, 500);
					//					}
				}
			});

			
		</script>
	</body>

</html>